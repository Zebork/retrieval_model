<!doctype html><html><script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script><meta charset="utf-8"><style>body {    margin-left: 0px;    margin-top: 0px;    margin-right: 0px;    margin-bottom: 0px;}.auto_hidden {    width:204px;border-top: 1px solid #333;    border-bottom: 1px solid #333;    border-left: 1px solid #333;    border-right: 1px solid #333;    position:absolute;    display:none;}.auto_show {    width:204px;    border-top: 1px solid #333;    border-bottom: 1px solid #333;    border-left: 1px solid #333;    border-right: 1px solid #333;    position:absolute;    z-index:9999; /* 设置对象的层叠顺序 */    display:block;}.auto_onmouseover{    color:#ffffff;    background-color:highlight;    width:100%;}.auto_onmouseout{    color:#000000;    width:100%;    background-color:#ffffff;}</style>    <script language="javascript">var $ = function (id) {    return "string" == typeof id ? document.getElementById(id) : id;}var Bind = function(object, fun) {    return function() {        return fun.apply(object, arguments);    }}function AutoComplete(obj,autoObj){    this.obj=$(obj);        //输入框    this.autoObj=$(autoObj);//DIV的根节点    //this.value_arr=arr;        //不要包含重复值    this.index=-1;          //当前选中的DIV的索引    this.search_value="";   //保存当前搜索的字符}AutoComplete.prototype={    //初始化DIV的位置    init: function(){        this.autoObj.style.left = this.obj.offsetLeft + "px";        this.autoObj.style.top  = this.obj.offsetTop + this.obj.offsetHeight + "px";        this.autoObj.style.width= this.obj.offsetWidth - 2 + "px";//减去边框的长度2px    },    //删除自动完成需要的所有DIV    deleteDIV: function(){        while(this.autoObj.hasChildNodes()){            this.autoObj.removeChild(this.autoObj.firstChild);        }        this.autoObj.className="auto_hidden";    },    //设置值    setValue: function(_this, index){        return function(){            //console.log(_this.autoObj.childNodes[index].seq)            _this.obj.value=_this.autoObj.childNodes[index].seq;            _this.autoObj.className="auto_hidden";        }    },    //模拟鼠标移动至DIV时，DIV高亮    autoOnmouseover: function(_this,_div_index){        return function(){            _this.index=_div_index;            var length = _this.autoObj.children.length;            for(var j=0;j<length;j++){                if(j!=_this.index ){                    _this.autoObj.childNodes[j].className='auto_onmouseout';                }else{                    _this.autoObj.childNodes[j].className='auto_onmouseover';                }            }        }    },    //更改classname    changeClassname: function(length){        for(var i=0;i<length;i++){            if(i!=this.index ){                this.autoObj.childNodes[i].className='auto_onmouseout';            }else{                this.autoObj.childNodes[i].className='auto_onmouseover';                this.obj.value=this.autoObj.childNodes[i].seq;            }        }    }    ,    //响应键盘    pressKey: function(event){        var length = this.autoObj.children.length;        //光标键"↓"        if(event.keyCode==40){            ++this.index;            if(this.index>length){                this.index=0;            }else if(this.index==length){                this.obj.value=this.search_value;            }            this.changeClassname(length);        }        //光标键"↑"        else if(event.keyCode==38){            this.index--;            if(this.index<-1){                this.index=length - 1;            }else if(this.index==-1){                this.obj.value=this.search_value;            }            this.changeClassname(length);        }        //回车键        else if(event.keyCode==13){            this.autoObj.className="auto_hidden";            this.index=-1;        }else{            this.index=-1;        }    },    //程序入口    start: function(event){        if(event.keyCode!=13&&event.keyCode!=38&&event.keyCode!=40){            this.init();            this.deleteDIV();            this.search_value=this.obj.value;   //需要ajax传递的参数            this.search_value = encodeURI(encodeURI(this.search_value));                        var self = this;            console.log(self.obj.value)             jQuery.noConflict();                        jQuery.ajax({                url:"/search/?phrase=" + this.obj.value,  //修改这个url并带参数                                dataType:'json',                  data:'',                  jsonp:'callback',                   //async: false                type:'GET',               // dataType:'json',                    success : function(result) {                          if(result){                        var div_index=0;//记录创建的DIV的索引                        //console.log(result)                                var dataObj=eval(result);                                                  for(var i in dataObj) {                            var div = document.createElement("div");                            //console.log(dataObj[i])                               div.className="auto_onmouseout";                            //console.log($("query"))                            div.seq=dataObj[i].name;                            div.onclick=self.setValue(self,div_index).bind($("lst-c")); //点击事件                            div.onmouseover=self.autoOnmouseover(self,div_index);     //鼠标移动事件                            div.innerHTML=dataObj[i].name;                            document.getElementById("autocom").appendChild(div);                            document.getElementById("autocom").className="auto_show";                            div_index++;                        }                                                            }                    },                    error : function(XMLHttpRequest, textStatus, errorThrown) {                          // alert(errorThrown);                      }             });                                }        this.pressKey(event);        window.onresize=Bind(this,function(){this.init();});    }}</script><body>    <div align="center" style="padding-top:50px">        <input type="text" style="width:300px;height:20px;font-size:14pt;" placeholder="请输入搜索关键字（测试输入“张”）" id="lst-c" onkeyup="autoComplete.start(event)">    </div>    <div class="auto_hidden" id="autocom"><!--自动完成 DIV--></div><!--搜索自动补全--><script  language="javascript" >    var autoComplete=new AutoComplete('lst-c','autocom'); //两参数分别是搜索框和下拉框的id</script><!--这一部分是相关搜索推荐  与自动补全同样思路，根据返回的json显示前9个在表格中这一部分的div应该放在搜索结果页面里，把recomm.js放同一目录，变量一个是关键字索引数组，一个是搜索内容-->    <div id="recommend">       <script src="/js/recommend.js" language="javascript">    </script><!--     <script language="javascript">    var search_value="张"; //用户搜索    recomm( search_value);    </script> -->    </div></body></html>